â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                   ARQUITECTURA DEL SISTEMA                                  â•‘
â•‘              Sistema ClÃ­nica MarÃ­a Inmaculada v1.0                         â•‘
â•‘                    Actualizado: Octubre 2025                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

================================================================================
                            ESTRUCTURA DEL PROYECTO
================================================================================

Sistema-Clinica-/
â”‚
â”œâ”€â”€ ğŸ“ backend/                          # Backend Python
â”‚   â”œâ”€â”€ ğŸ“ core/                         # MÃ³dulos centrales
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config.py                    # ConfiguraciÃ³n del sistema
â”‚   â”‚   â”œâ”€â”€ database_conexion.py        # ConexiÃ³n a SQL Server
â”‚   â”‚   â”œâ”€â”€ cache_system.py             # Sistema de cachÃ©
â”‚   â”‚   â”œâ”€â”€ excepciones.py              # Excepciones personalizadas
â”‚   â”‚   â”œâ”€â”€ base_repository.py          # Repositorio base
â”‚   â”‚   â”œâ”€â”€ utils.py                     # Utilidades generales
â”‚   â”‚   â”œâ”€â”€ db_installer.py             # Instalador de BD
â”‚   â”‚   â”œâ”€â”€ Signal_manager.py             
â”‚   â”‚   â”œâ”€â”€ login.py            
â”‚   â”‚   â””â”€â”€ config_manager.py           # Gestor de configuraciÃ³n
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ models/                       # Modelos QObject (Qt)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ auth_model.py                # AutenticaciÃ³n
â”‚   â”‚   â”œâ”€â”€ usuario_model.py             # Usuarios
â”‚   â”‚   â”œâ”€â”€ paciente_model.py            # Pacientes
â”‚   â”‚   â”œâ”€â”€ trabajador_model.py          # Trabajadores
â”‚   â”‚   â”œâ”€â”€ consulta_model.py            # Consultas mÃ©dicas
â”‚   â”‚   â”œâ”€â”€ enfermeria_model.py          # EnfermerÃ­a
â”‚   â”‚   â”œâ”€â”€ laboratorio_model.py         # Laboratorio
â”‚   â”‚   â”œâ”€â”€ inventario_model.py          # Inventario (FIFO)
â”‚   â”‚   â”œâ”€â”€ proveedor_model.py           # Proveedores
â”‚   â”‚   â”œâ”€â”€ compra_model.py              # Compras
â”‚   â”‚   â”œâ”€â”€ venta_model.py               # Ventas
â”‚   â”‚   â”œâ”€â”€ gasto_model.py               # Gastos
â”‚   â”‚   â”œâ”€â”€ cierre_caja_model.py         # Cierre de caja
â”‚   â”‚   â”œâ”€â”€ ingreso_extra_model.py       # Ingresos extras
â”‚   â”‚   â”œâ”€â”€ reportes_model.py            # Reportes
â”‚   â”‚   â”œâ”€â”€ dashboard_model.py           # Dashboard
â”‚   â”‚   â”œâ”€â”€ medico_model.py 
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ ConfiguracionModel/       # ConfiguraciÃ³n
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ ConfiConsulta_model.py
â”‚   â”‚       â”œâ”€â”€ ConfiEnfermeria_model.py
â”‚   â”‚       â”œâ”€â”€ ConfiLaboratorio_model.py
â”‚   â”‚       â”œâ”€â”€ ConfiServiciosbasicos_model.py
â”‚   â”‚       â””â”€â”€ ConfiTrabajadores_model.py
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ repositories/                 # Repositorios (Acceso a datos)
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ auth_repository.py
â”‚       â”œâ”€â”€ usuario_repository.py
â”‚       â”œâ”€â”€ paciente_repository.py
â”‚       â”œâ”€â”€ trabajador_repository.py
â”‚       â”œâ”€â”€ consulta_repository.py
â”‚       â”œâ”€â”€ enfermeria_repository.py
â”‚       â”œâ”€â”€ laboratorio_repository.py
â”‚       â”œâ”€â”€ producto_repository.py
â”‚       â”œâ”€â”€ proveedor_repository.py
â”‚       â”œâ”€â”€ compra_repository.py
â”‚       â”œâ”€â”€ venta_repository.py
â”‚       â”œâ”€â”€ gasto_repository.py
â”‚       â”œâ”€â”€ cierre_caja_repository.py
â”‚       â”œâ”€â”€ ingreso_extra_repository.py
â”‚       â”œâ”€â”€ reportes_repository.py
â”‚       â”œâ”€â”€ egreso_repository.py
â”‚       â”œâ”€â”€ medico_repository.py
â”‚       â”œâ”€â”€ especialidad_repository.py
â”‚       â”œâ”€â”€ estadistica_repository.py
â”‚       â”‚
â”‚       â””â”€â”€ ğŸ“ ConfiguracionRepositor/   # ConfiguraciÃ³n
â”‚           â”œâ”€â”€ __init__.py
â”‚           â”œâ”€â”€ ConfiConsulta_repository.py
â”‚           â”œâ”€â”€ ConfiEnfermeria_repository.py
â”‚           â”œâ”€â”€ ConfiLaboratorio_repository.py
â”‚           â”œâ”€â”€ ConfiServiciosbasicos_repository.py
â”‚           â””â”€â”€ ConfiTrabajadores_repository.py
â”‚
â”œâ”€â”€ ğŸ“ database_scripts/                 # âœ… Scripts SQL
â”‚   â”œâ”€â”€ 01_schema.sql                    # Estructura de BD
â”‚   â””â”€â”€ 02_datos_iniciales.sql          # âœ… NUEVO - Datos iniciales
â”‚
â”œâ”€â”€ ğŸ“ Resources/                        # Recursos
â”‚   â”œâ”€â”€ ğŸ“ iconos/                       # Iconos del sistema
â”‚   â”‚   â”œâ”€â”€ logo_CMI.svg
â”‚   â”‚   â”œâ”€â”€ logo_CMI.ico
â”‚   â”‚   â””â”€â”€ [otros iconos...]
â”‚   â””â”€â”€ ğŸ“ fonts/                        # Fuentes (opcional)
â”‚
â”œâ”€â”€ ğŸ“ assets/                           # Assets adicionales
â”‚   â””â”€â”€ [recursos adicionales]
â”‚
â”œâ”€â”€ ğŸ“ reportes/                         # âœ… Reportes generados
â”‚   â””â”€â”€ [PDFs generados automÃ¡ticamente]
â”‚
â”œâ”€â”€ ğŸ“ logs/                             # âœ… Logs del sistema
â”‚   â””â”€â”€ [archivos .log]
â”‚
â”œâ”€â”€ ğŸ“ temp/                             # âœ… Archivos temporales
â”‚   â””â”€â”€ [archivos temporales]
â”‚
â”œâ”€â”€ ğŸ“„ main.py                           # âœ… MODIFICADO - Punto de entrada
â”œâ”€â”€ ğŸ“„ setup_handler.py                  # âœ… NUEVO - Handler del wizard
â”œâ”€â”€ ğŸ“„ generar_pdf.py                    # Generador de PDFs
â”‚
â”œâ”€â”€ ğŸ“„ main.qml                          # Ventana principal
â”œâ”€â”€ ğŸ“„ login.qml                         # Pantalla de login
â”œâ”€â”€ ğŸ“„ setup_wizard.qml                  # âœ… NUEVO - Wizard de configuraciÃ³n
â”œâ”€â”€ ğŸ“„ Dashboard.qml                     # Dashboard principal
â”‚
â”œâ”€â”€ ğŸ“„ Farmacia.qml                      # MÃ³dulo Farmacia
â”œâ”€â”€ ğŸ“„ Productos.qml                     # GestiÃ³n de productos
â”œâ”€â”€ ğŸ“„ CrearProducto.qml                 # Crear producto
â”œâ”€â”€ ğŸ“„ DetalleProducto.qml               # Detalle de producto
â”‚
â”œâ”€â”€ ğŸ“„ Ventas.qml                        # MÃ³dulo Ventas
â”œâ”€â”€ ğŸ“„ VentasMain.qml                    # Main de ventas
â”œâ”€â”€ ğŸ“„ CrearVenta.qml                    # Crear venta
â”‚
â”œâ”€â”€ ğŸ“„ Compras.qml                       # MÃ³dulo Compras
â”œâ”€â”€ ğŸ“„ ComprasMain.qml                   # Main de compras
â”œâ”€â”€ ğŸ“„ CrearCompra.qml                   # Crear compra
â”‚
â”œâ”€â”€ ğŸ“„ Proveedores.qml                   # GestiÃ³n de proveedores
â”œâ”€â”€ ğŸ“„ CrearProveedor.qml                # Crear proveedor
â”‚
â”œâ”€â”€ ğŸ“„ Consultas.qml                     # MÃ³dulo Consultas
â”œâ”€â”€ ğŸ“„ Laboratorio.qml                   # MÃ³dulo Laboratorio
â”œâ”€â”€ ğŸ“„ Enfermeria.qml                    # MÃ³dulo EnfermerÃ­a
â”‚
â”œâ”€â”€ ğŸ“„ ServiciosBasicos.qml              # MÃ³dulo Gastos
â”œâ”€â”€ ğŸ“„ Trabajadores.qml                  # GestiÃ³n de trabajadores
â”œâ”€â”€ ğŸ“„ Usuario.qml                       # GestiÃ³n de usuarios
â”‚
â”œâ”€â”€ ğŸ“„ Configuracion.qml                 # ConfiguraciÃ³n general
â”œâ”€â”€ ğŸ“„ ConfiConsultas.qml                # Config. Consultas
â”œâ”€â”€ ğŸ“„ ConfiEnfermeria.qml               # Config. EnfermerÃ­a
â”œâ”€â”€ ğŸ“„ ConfiLaboratorio.qml              # Config. Laboratorio
â”œâ”€â”€ ğŸ“„ ConfiServiciosBasicos.qml         # Config. Gastos
â”œâ”€â”€ ğŸ“„ ConfiTrabajadores.qml             # Config. Trabajadores
â”œâ”€â”€ ğŸ“„ ConfiUsuarios.qml                 # Config. Usuarios
â”‚
â”œâ”€â”€ ğŸ“„ Reportes.qml                      # MÃ³dulo Reportes
â”œâ”€â”€ ğŸ“„ CierreCaja.qml                    # Cierre de caja
â”œâ”€â”€ ğŸ“„ IngresosExtras.qml                # Ingresos extras
â”‚
â”œâ”€â”€ ğŸ“„ MarcaComboBox.qml                 # Componente ComboBox
â”œâ”€â”€ ğŸ“„ ProveedorComboBox.qml             # Componente ComboBox
â”œâ”€â”€ ğŸ“„ GlobalDataCenter.qml              # Centro de datos global
â”‚
â”œâ”€â”€ ğŸ“„ .env                              # âœ… ConfiguraciÃ³n local (NO subir a Git)
â”œâ”€â”€ ğŸ“„ .gitignore                        # âœ… Archivos ignorados por Git
â”œâ”€â”€ ğŸ“„ requirements.txt                  # Dependencias Python
â”œâ”€â”€ ğŸ“„ clinica.spec                      # âœ… ACTUALIZADO - Config PyInstaller
â”œâ”€â”€ ğŸ“„ dependencias_actuales.txt         # DocumentaciÃ³n de dependencias
â”œâ”€â”€ ğŸ“„ README.md                         # âœ… DocumentaciÃ³n principal
â””â”€â”€ ğŸ“„ LEEME.txt                         # âœ… Instrucciones para usuarios

================================================================================
                            MÃ“DULOS PRINCIPALES
================================================================================

1. ğŸ” AUTENTICACIÃ“N Y USUARIOS
   â”œâ”€â”€ Login con validaciÃ³n
   â”œâ”€â”€ GestiÃ³n de usuarios
   â”œâ”€â”€ Roles y permisos (Administrador, MÃ©dico)
   â””â”€â”€ âœ… Setup Wizard para primera configuraciÃ³n

2. ğŸ’Š FARMACIA
   â”œâ”€â”€ Inventario con sistema FIFO
   â”œâ”€â”€ GestiÃ³n de productos
   â”œâ”€â”€ GestiÃ³n de marcas
   â”œâ”€â”€ Control de lotes con fechas de vencimiento
   â”œâ”€â”€ Alertas de productos prÃ³ximos a vencer
   â””â”€â”€ Alertas de stock bajo

3. ğŸª VENTAS Y COMPRAS
   â”œâ”€â”€ Registro de ventas (FIFO automÃ¡tico)
   â”œâ”€â”€ Registro de compras por lote
   â”œâ”€â”€ GestiÃ³n de proveedores
   â”œâ”€â”€ Historial de transacciones
   â””â”€â”€ Control de stock automatizado

4. ğŸ©º CONSULTAS MÃ‰DICAS
   â”œâ”€â”€ Registro de pacientes (con/sin cÃ©dula)
   â”œâ”€â”€ GestiÃ³n de consultas
   â”œâ”€â”€ Especialidades mÃ©dicas
   â”œâ”€â”€ Precios normal/emergencia
   â””â”€â”€ Historial clÃ­nico

5. ğŸ”¬ LABORATORIO
   â”œâ”€â”€ Tipos de anÃ¡lisis clÃ­nicos
   â”œâ”€â”€ Registro de exÃ¡menes
   â”œâ”€â”€ AsignaciÃ³n de trabajadores
   â”œâ”€â”€ Precios normal/emergencia
   â””â”€â”€ Historial de anÃ¡lisis

6. ğŸ’‰ ENFERMERÃA
   â”œâ”€â”€ Tipos de procedimientos
   â”œâ”€â”€ Registro de procedimientos
   â”œâ”€â”€ AsignaciÃ³n de personal
   â”œâ”€â”€ Precios normal/emergencia
   â””â”€â”€ Historial de procedimientos

7. ğŸ’° GESTIÃ“N FINANCIERA
   â”œâ”€â”€ Registro de gastos
   â”œâ”€â”€ Tipos de gastos
   â”œâ”€â”€ Proveedores de gastos
   â”œâ”€â”€ Ingresos extras
   â”œâ”€â”€ Cierre de caja diario
   â””â”€â”€ Control de efectivo

8. ğŸ“Š DASHBOARD Y REPORTES
   â”œâ”€â”€ Dashboard con estadÃ­sticas en tiempo real
   â”œâ”€â”€ Ingresos por mÃ³dulo (Farmacia, Consultas, Lab, EnfermerÃ­a)
   â”œâ”€â”€ Egresos (Servicios bÃ¡sicos)
   â”œâ”€â”€ Alertas de inventario
   â”œâ”€â”€ GeneraciÃ³n de reportes PDF
   â”‚   â”œâ”€â”€ Reporte de ventas
   â”‚   â”œâ”€â”€ Reporte de compras
   â”‚   â”œâ”€â”€ Reporte de consultas
   â”‚   â”œâ”€â”€ Reporte de laboratorio
   â”‚   â”œâ”€â”€ Reporte de enfermerÃ­a
   â”‚   â”œâ”€â”€ Reporte de gastos
   â”‚   â”œâ”€â”€ Reporte de ingresos/egresos
   â”‚   â””â”€â”€ Arqueo de caja
   â””â”€â”€ Filtros por fecha y tipo

9. âš™ï¸ CONFIGURACIÃ“N
   â”œâ”€â”€ ConfiguraciÃ³n de consultas
   â”œâ”€â”€ ConfiguraciÃ³n de enfermerÃ­a
   â”œâ”€â”€ ConfiguraciÃ³n de laboratorio
   â”œâ”€â”€ ConfiguraciÃ³n de gastos
   â”œâ”€â”€ ConfiguraciÃ³n de trabajadores
   â””â”€â”€ GestiÃ³n de usuarios

================================================================================
                         TECNOLOGÃAS UTILIZADAS
================================================================================

Frontend:
  â€¢ PySide6 (Qt for Python) 6.9.1
  â€¢ QML (Qt Quick)
  â€¢ Qt Quick Controls 2

Backend:
  â€¢ Python 3.11+
  â€¢ Arquitectura MVC (Model-View-Controller)
  â€¢ PatrÃ³n Repository para acceso a datos
  â€¢ Sistema de cachÃ© para optimizaciÃ³n

Base de Datos:
  â€¢ SQL Server Express
  â€¢ pyodbc 5.2.0
  â€¢ âœ… Scripts SQL automatizados
  â€¢ âœ… Instalador automÃ¡tico de BD

Reportes:
  â€¢ ReportLab 4.4.3
  â€¢ Pillow 11.3.0 (procesamiento de imÃ¡genes)

GestiÃ³n de ConfiguraciÃ³n:
  â€¢ python-dotenv 1.1.1
  â€¢ âœ… ConfigManager para gestiÃ³n de .env

Empaquetado:
  â€¢ PyInstaller 6.16.0
  â€¢ âœ… clinica.spec optimizado

Otras Dependencias:
  â€¢ Flask 3.1.1 (opcional, para futuras APIs)
  â€¢ flask-cors 6.0.1

================================================================================
                         FLUJO DE TRABAJO
================================================================================

ğŸ“Œ PRIMERA EJECUCIÃ“N (Setup AutomÃ¡tico):
   1. Usuario ejecuta ClinicaApp.exe
   2. Sistema detecta que no existe .env
   3. Muestra Setup Wizard automÃ¡ticamente
   4. Usuario hace click en "Setup AutomÃ¡tico"
   5. Sistema:
      â”œâ”€â”€ Verifica SQL Server instalado
      â”œâ”€â”€ Crea base de datos ClinicaMariaInmaculada
      â”œâ”€â”€ Ejecuta 01_schema.sql (estructura)
      â”œâ”€â”€ Ejecuta 02_datos_iniciales.sql (datos base)
      â”œâ”€â”€ Crea usuario admin (admin/admin123)
      â”œâ”€â”€ Genera archivo .env con configuraciÃ³n
      â””â”€â”€ Muestra credenciales al usuario
   6. Usuario hace click en "IR AL LOGIN"
   7. Sistema muestra pantalla de login
   8. Usuario inicia sesiÃ³n con admin/admin123

ğŸ“Œ EJECUCIONES POSTERIORES (Login Normal):
   1. Usuario ejecuta ClinicaApp.exe
   2. Sistema detecta que existe .env
   3. Muestra pantalla de login directamente
   4. Usuario inicia sesiÃ³n
   5. Sistema carga dashboard y mÃ³dulos

ğŸ“Œ FLUJO DE VENTA:
   1. Usuario selecciona productos
   2. Sistema aplica FIFO automÃ¡ticamente
   3. Descuenta del lote mÃ¡s antiguo primero
   4. Actualiza stock en tiempo real
   5. Genera reporte PDF (opcional)

ğŸ“Œ FLUJO DE COMPRA:
   1. Usuario crea nuevo lote
   2. Ingresa datos (producto, cantidad, vencimiento)
   3. Sistema registra compra
   4. Actualiza inventario
   5. Stock disponible = suma de lotes

ğŸ“Œ FLUJO DE CONSULTA:
   1. Buscar/crear paciente (por cÃ©dula o nombre)
   2. Seleccionar especialidad
   3. Registrar consulta
   4. Sistema calcula precio (normal/emergencia)
   5. Genera registro en BD

ğŸ“Œ CIERRE DE CAJA:
   1. Usuario ingresa rango horario
   2. Sistema calcula automÃ¡ticamente:
      â”œâ”€â”€ Ingresos (Farmacia + Consultas + Lab + EnfermerÃ­a + Extras)
      â”œâ”€â”€ Egresos (Gastos)
      â””â”€â”€ Saldo teÃ³rico
   3. Usuario ingresa efectivo real
   4. Sistema calcula diferencia
   5. Genera PDF de arqueo


================================================================================
                       CARACTERÃSTICAS TÃ‰CNICAS
================================================================================

âœ… Sistema FIFO Completo:
   â€¢ Control de lotes con fechas
   â€¢ Venta automÃ¡tica del lote mÃ¡s antiguo
   â€¢ Alertas de vencimiento (60 dÃ­as)
   â€¢ Trazabilidad completa

âœ… Sistema de CachÃ©:
   â€¢ CachÃ© por tipo (consultas, laboratorio, etc.)
   â€¢ InvalidaciÃ³n automÃ¡tica
   â€¢ ReducciÃ³n de consultas a BD
   â€¢ Mejor rendimiento

âœ… Sistema de Permisos:
   â€¢ Rol Administrador: Acceso total
   â€¢ Rol MÃ©dico: Acceso a mÃ³dulos clÃ­nicos
   â€¢ ValidaciÃ³n en backend y frontend
   â€¢ Seguridad por capas

âœ… GeneraciÃ³n de Reportes PDF:
   â€¢ Encabezado con logo y datos
   â€¢ Tablas formateadas
   â€¢ ResÃºmenes automÃ¡ticos
   â€¢ Filtros por fecha
   â€¢ Guardado automÃ¡tico en carpeta reportes/

âœ… Setup Wizard (Primera Vez):
   â€¢ DetecciÃ³n automÃ¡tica de primera ejecuciÃ³n
   â€¢ InstalaciÃ³n automÃ¡tica de base de datos
   â€¢ CreaciÃ³n de usuario admin
   â€¢ ConfiguraciÃ³n sin intervenciÃ³n manual
   â€¢ ValidaciÃ³n de SQL Server

âœ… Interfaz Responsive:
   â€¢ DiseÃ±o adaptable
   â€¢ Componentes reutilizables
   â€¢ NavegaciÃ³n fluida
   â€¢ Feedback visual



================================================================================
                       ARCHIVOS DE CONFIGURACIÃ“N
================================================================================

ğŸ“„ .env (Generado automÃ¡ticamente por Setup Wizard):
   DB_SERVER=localhost\SQLEXPRESS
   DB_DATABASE=ClinicaMariaInmaculada
   DB_TRUSTED_CONNECTION=yes
   DB_TIMEOUT=30
   FIRST_TIME_SETUP=False
   
   âš ï¸ Este archivo NO debe incluirse en Git
   âš ï¸ NO debe incluirse en el ZIP de distribuciÃ³n

ğŸ“„ .gitignore (Control de versiones):
   â€¢ Excluye venv/, dist/, build/
   â€¢ Excluye .env y archivos de configuraciÃ³n local
   â€¢ Excluye reportes generados
   â€¢ Excluye logs y temporales

ğŸ“„ requirements.txt (Dependencias):
   PySide6==6.9.1
   pyodbc==5.2.0
   reportlab==4.4.3
   python-dotenv==1.1.1
   pillow==11.3.0
   pyinstaller==6.16.0
   flask==3.1.1
   flask-cors==6.0.1