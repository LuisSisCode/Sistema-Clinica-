<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Gesti√≥n - Cl√≠nica M√©dica</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            color: #334155;
            line-height: 1.6;
        }

        .dashboard {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0, 90, 156, 0.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #e2e8f0;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #005A9C, #4DBA87);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #005A9C;
        }

        .filter-chips {
            display: flex;
            gap: 0.5rem;
        }

        .chip {
            padding: 0.5rem 1.2rem;
            border: 2px solid #e2e8f0;
            border-radius: 50px;
            background: white;
            color: #64748b;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .chip.active {
            background: #005A9C;
            color: white;
            border-color: #005A9C;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 90, 156, 0.3);
        }

        .chip:hover:not(.active) {
            border-color: #4DBA87;
            color: #4DBA87;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .date-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: #f8fafc;
            padding: 0.5rem 1rem;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }

        .date-selector select {
            border: none;
            background: transparent;
            color: #64748b;
            font-weight: 500;
        }

        .user-profile {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #4DBA87, #005A9C);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex; 
            flex-direction: column;
            gap: 2rem;
            padding: 2rem;
        }

        /* ------ NUEVO CONTENEDOR PARA LOS WIDGETS PRINCIPALES ------ */
        .main-widgets-container {
            display: grid;
            grid-template-columns: 2fr 1fr; /* Columna izquierda m√°s ancha */
            gap: 2rem;
        }

        .widget {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #f1f5f9;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .widget:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .widget-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .widget-icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #005A9C, #4DBA87);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .chart-container.large {
            height: 400px;
        }

        /* KPI Cards Grid */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1.5rem;
        }

        .kpi-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #f1f5f9;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
            text-align: center;
        }

        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .kpi-card.blue { border-top: 4px solid #3b82f6; }
        .kpi-card.green { border-top: 4px solid #10b981; }
        .kpi-card.orange { border-top: 4px solid #f59e0b; }
        .kpi-card.purple { border-top: 4px solid #8b5cf6; }
        .kpi-card.pink { border-top: 4px solid #ec4899; }

        .kpi-icon {
            width: 50px;
            height: 50px;
            margin: 0 auto 1rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .kpi-icon.blue { background: linear-gradient(135deg, #dbeafe, #bfdbfe); color: #1d4ed8; }
        .kpi-icon.green { background: linear-gradient(135deg, #d1fae5, #a7f3d0); color: #047857; }
        .kpi-icon.orange { background: linear-gradient(135deg, #fef3c7, #fde68a); color: #d97706; }
        .kpi-icon.purple { background: linear-gradient(135deg, #ede9fe, #ddd6fe); color: #7c3aed; }
        .kpi-icon.pink { background: linear-gradient(135deg, #fce7f3, #fbcfe8); color: #be185d; }

        .kpi-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 0.5rem 0;
            color: #1e293b;
        }

        .kpi-label {
            font-size: 0.9rem;
            color: #64748b;
            font-weight: 500;
        }

        .alert-table { width: 100%; border-collapse: collapse; }
        .alert-table th { background: #f8fafc; padding: 0.75rem; text-align: left; font-weight: 600; color: #475569; border-bottom: 2px solid #e2e8f0; }
        .alert-table td { padding: 0.75rem; border-bottom: 1px solid #e2e8f0; }
        .alert-row.urgent { background: rgba(229, 115, 115, 0.1); border-left: 4px solid #E57373; }
        .alert-row.warning { background: rgba(255, 193, 7, 0.1); border-left: 4px solid #ffc107; }
        .status-badge { padding: 0.25rem 0.5rem; border-radius: 20px; font-size: 0.8rem; font-weight: 500; }
        .status-urgent { background: #fee2e2; color: #dc2626; }
        .status-warning { background: #fef3c7; color: #d97706; }

        /* Media Queries para responsividad */
        @media (max-width: 1200px) {
            .kpi-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            /* ------ MEDIA QUERY PARA EL NUEVO CONTENEDOR ------ */
            .main-widgets-container {
                grid-template-columns: 1fr; /* Apila los widgets en pantallas medianas */
            }
        }
        
        @media (max-width: 900px) {
            .kpi-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .header { flex-direction: column; gap: 1rem; text-align: center; }
            .filter-chips { justify-content: center; }
            .main-content { padding: 1rem; gap: 1.5rem; }
            .kpi-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <header class="header">
            <div class="logo-section">
                <div class="logo">CM</div>
                <h1 class="title">Dashboard de Gesti√≥n</h1>
            </div>
            
            <div class="filter-chips">
                <button class="chip active" onclick="setActiveFilter(this, 'general')">General</button>
                <button class="chip" onclick="setActiveFilter(this, 'farmacia')">Farmacia</button>
                <button class="chip" onclick="setActiveFilter(this, 'consultas')">Consultas</button>
                <button class="chip" onclick="setActiveFilter(this, 'servicios')">Servicios B√°sicos</button>
            </div>
            
            <div class="header-right">
                <div class="date-selector">
                    <select>
                        <option>Junio</option>
                        <option>Mayo</option>
                        <option>Abril</option>
                    </select>
                    <select>
                        <option>2025</option>
                        <option>2024</option>
                    </select>
                </div>
                <div class="user-profile">U</div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            
            <!-- Fila de 5 KPI Cards -->
            <div class="kpi-grid">
                <div class="kpi-card blue">
                    <div class="kpi-icon blue">üìÖ</div>
                    <div class="kpi-value" id="kpi-consultas">45</div>
                    <div class="kpi-label">Consultas D√≠a</div>
                </div>
                <div class="kpi-card green">
                    <div class="kpi-icon green">üíä</div>
                    <div class="kpi-value" id="kpi-farmacia">2,450 Bs</div>
                    <div class="kpi-label">Venta Farmacia D√≠a</div>
                </div>
                <div class="kpi-card orange">
                    <div class="kpi-icon orange">üîß</div>
                    <div class="kpi-value" id="kpi-servicios">8,200 Bs</div>
                    <div class="kpi-label">Gasto en Servicios Mes</div>
                </div>
                <div class="kpi-card purple">
                    <div class="kpi-icon purple">üí∞</div>
                    <div class="kpi-value" id="kpi-ganancias">15,800 Bs</div>
                    <div class="kpi-label">Ganancias Mensual</div>
                </div>
                <div class="kpi-card pink">
                    <div class="kpi-icon pink">üë•</div>
                    <div class="kpi-value" id="kpi-personal">15,200 Bs</div>
                    <div class="kpi-label">Gasto Personal Mes</div>
                </div>
            </div>

            <!-- ------ ESTRUCTURA HTML MODIFICADA ------ -->
            <!-- Contenedor para los 2 widgets principales -->
            <div class="main-widgets-container">

                <!-- Flujo de Caja (Columna izquierda) -->
                <div class="widget">
                    <h2 class="widget-title">
                        <div class="widget-icon">üìà</div>
                        Flujo de Caja Mensual
                    </h2>
                    <div class="chart-container large">
                        <canvas id="cashFlowChart"></canvas>
                    </div>
                </div>

                <!-- Alertas de Vencimiento (Columna derecha) -->
                <div class="widget">
                    <h2 class="widget-title">
                        <div class="widget-icon" style="background: #E57373;">‚ö†Ô∏è</div>
                        Alerta: Productos por Vencer
                    </h2>
                    <table class="alert-table">
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>Cantidad</th>
                                <th>Vencimiento</th>
                            </tr>
                        </thead>
                        <tbody id="alerts-tbody">
                            <tr class="alert-row urgent">
                                <td>Amoxicilina 500mg</td>
                                <td>45 unid.</td>
                                <td><span class="status-badge status-urgent">20/06/2025</span></td>
                            </tr>
                            <tr class="alert-row warning">
                                <td>Paracetamol 750mg</td>
                                <td>120 unid.</td>
                                <td><span class="status-badge status-warning">15/07/2025</span></td>
                            </tr>
                            <tr class="alert-row warning">
                                <td>Ibuprofeno 400mg</td>
                                <td>78 unid.</td>
                                <td><span class="status-badge status-warning">28/07/2025</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </div>
            <!-- Fin del contenedor de widgets -->

        </main>
    </div>

    <script>
        // El c√≥digo JavaScript no necesita cambios para este ajuste de layout.
        // Se pega aqu√≠ para que tengas el archivo completo y funcional.
        let cashFlowChart;
        let currentFilter = 'general';
        const chartData = {
            general: {
                kpis: {
                    consultas: '45', farmacia: '2,450 Bs', servicios: '8,200 Bs', ganancias: '15,800 Bs', personal: '15,200 Bs'
                },
                cashFlow: {
                    labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
                    ingresos: [28000, 32000, 35000, 31000, 38000, 42000, 39000, 44000, 41000, 45000, 48000, 52000],
                    egresos: [22000, 24000, 26000, 25000, 28000, 30000, 29000, 32000, 31000, 33000, 35000, 38000]
                },
                alerts: [
                    { producto: 'Amoxicilina 500mg', cantidad: '45 unid.', fecha: '20/06/2025', urgencia: 'urgent' },
                    { producto: 'Paracetamol 750mg', cantidad: '120 unid.', fecha: '15/07/2025', urgencia: 'warning' },
                    { producto: 'Ibuprofeno 400mg', cantidad: '78 unid.', fecha: '28/07/2025', urgencia: 'warning' }
                ]
            },
            farmacia: {
                kpis: {
                    consultas: '0', farmacia: '3,200 Bs', servicios: '1,500 Bs', ganancias: '8,900 Bs', personal: '4,800 Bs'
                },
                cashFlow: {
                    labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
                    ingresos: [12600, 14400, 15750, 13950, 17100, 18900, 17550, 19800, 18450, 20250, 21600, 23400],
                    egresos: [9800, 11200, 12300, 10900, 13400, 14800, 13700, 15500, 14400, 15800, 16900, 18200]
                },
                alerts: [
                    { producto: 'Amoxicilina 500mg', cantidad: '45 unid.', fecha: '20/06/2025', urgencia: 'urgent' },
                    { producto: 'Paracetamol 750mg', cantidad: '120 unid.', fecha: '15/07/2025', urgencia: 'warning' },
                    { producto: 'Vitamina D3', cantidad: '30 unid.', fecha: '25/07/2025', urgencia: 'warning' },
                    { producto: 'Omeprazol 20mg', cantidad: '60 unid.', fecha: '02/08/2025', urgencia: 'warning' }
                ]
            },
            consultas: {
                kpis: {
                    consultas: '67', farmacia: '0 Bs', servicios: '2,100 Bs', ganancias: '12,400 Bs', personal: '8,900 Bs'
                },
                cashFlow: {
                    labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
                    ingresos: [9800, 11200, 12250, 10850, 13300, 14700, 13650, 15400, 14350, 15750, 16800, 18200],
                    egresos: [7700, 8400, 9100, 8750, 9800, 10500, 10150, 11200, 10850, 11550, 12250, 13300]
                },
                alerts: [
                    { producto: 'Citas Pendientes', cantidad: '12 pac.', fecha: '17/06/2025', urgencia: 'urgent' },
                    { producto: 'Seguimientos', cantidad: '8 pac.', fecha: '20/06/2025', urgencia: 'warning' },
                    { producto: 'Resultados Lab', cantidad: '5 pac.', fecha: '22/06/2025', urgencia: 'warning' }
                ]
            },
            servicios: {
                kpis: {
                    consultas: '12', farmacia: '450 Bs', servicios: '15,600 Bs', ganancias: '7,200 Bs', personal: '1,500 Bs'
                },
                cashFlow: {
                    labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
                    ingresos: [5600, 6400, 7000, 6200, 7600, 8400, 7800, 8800, 8200, 9000, 9600, 10400],
                    egresos: [4500, 4400, 4600, 4350, 4800, 5200, 5150, 5300, 4750, 5650, 6150, 6500]
                },
                alerts: [
                    { producto: 'Reactivos Lab', cantidad: '8 kits', fecha: '25/06/2025', urgencia: 'urgent' },
                    { producto: 'Placas Rayos X', cantidad: '25 unid.', fecha: '30/06/2025', urgencia: 'warning' },
                    { producto: 'Papel ECG', cantidad: '15 rollos', fecha: '05/07/2025', urgencia: 'warning' }
                ]
            }
        };
        const colors = { primary: '#005A9C', accent: '#4DBA87', danger: '#E57373', background: '#f8fafc' };

        function setActiveFilter(button, filter) {
            document.querySelectorAll('.chip').forEach(chip => chip.classList.remove('active'));
            button.classList.add('active');
            currentFilter = filter;
            setTimeout(() => { updateCharts(filter); updateKPIs(filter); updateAlerts(filter); }, 100);
        }

        function updateCharts(filter) {
            const data = chartData[filter];
            if (cashFlowChart && cashFlowChart.data && cashFlowChart.data.datasets) {
                cashFlowChart.data.datasets[0].data = data.cashFlow.ingresos;
                cashFlowChart.data.datasets[1].data = data.cashFlow.egresos;
                cashFlowChart.update('active');
            }
        }

        function updateKPIs(filter) {
            const data = chartData[filter].kpis;
            document.getElementById('kpi-consultas').textContent = data.consultas;
            document.getElementById('kpi-farmacia').textContent = data.farmacia;
            document.getElementById('kpi-servicios').textContent = data.servicios;
            document.getElementById('kpi-ganancias').textContent = data.ganancias;
            document.getElementById('kpi-personal').textContent = data.personal;
        }

        function updateAlerts(filter) {
            const data = chartData[filter];
            const tbody = document.getElementById('alerts-tbody');
            tbody.innerHTML = '';
            data.alerts.forEach(alert => {
                const row = document.createElement('tr');
                row.className = `alert-row ${alert.urgencia}`;
                row.innerHTML = `<td>${alert.producto}</td><td>${alert.cantidad}</td><td><span class="status-badge status-${alert.urgencia}">${alert.fecha}</span></td>`;
                tbody.appendChild(row);
            });
        }

        window.addEventListener('load', function() {
            if (typeof Chart === 'undefined') { console.error('Chart.js no se carg√≥ correctamente'); return; }
            const generalData = chartData.general;
            const cashFlowCtx = document.getElementById('cashFlowChart').getContext('2d');
            cashFlowChart = new Chart(cashFlowCtx, {
                type: 'line',
                data: {
                    labels: generalData.cashFlow.labels,
                    datasets: [{
                        label: 'Ingresos', data: generalData.cashFlow.ingresos, borderColor: colors.accent, backgroundColor: colors.accent + '20', tension: 0.4, fill: true, pointBackgroundColor: colors.accent, pointBorderColor: '#fff', pointBorderWidth: 3, pointRadius: 6
                    }, {
                        label: 'Egresos', data: generalData.cashFlow.egresos, borderColor: colors.danger, backgroundColor: colors.danger + '20', tension: 0.4, fill: true, pointBackgroundColor: colors.danger, pointBorderColor: '#fff', pointBorderWidth: 3, pointRadius: 6
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { position: 'top', labels: { usePointStyle: true, padding: 20, font: { weight: 'bold' } } } },
                    scales: {
                        y: { beginAtZero: true, ticks: { callback: function(value) { return value.toLocaleString() + ' Bs'; } }, grid: { color: '#f1f5f9' } },
                        x: { grid: { display: false } }
                    },
                    interaction: { intersect: false, mode: 'index' }
                }
            });
            updateKPIs('general');
        });
    </script>
</body>
</html>